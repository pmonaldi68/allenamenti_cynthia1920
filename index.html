<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piano Allenamenti Cynthia - Live</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f4f7fa; --text: #1e293b; --white: #ffffff; --primary: #003366;
            --abbatini: #003366; --infiorata: #00a8e8; --montegiove: #2ecc71;
            --lun: #475569; --mar: #10b981; --mer: #f59e0b; --gio: #8b5cf6; --ven: #ef4444;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        header { text-align: center; padding: 30px; background: var(--white); margin-bottom: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .logo { max-width: 110px; height: auto; margin-bottom: 15px; }
        h1 { font-size: 1.6rem; color: var(--primary); text-transform: uppercase; margin: 0; letter-spacing: 1px; }
        .filter-section { max-width: 1100px; margin: 0 auto 30px auto; display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; }
        .filter-input, .filter-select { padding: 14px 20px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; min-width: 260px; outline: none; transition: 0.3s; }
        .team-group { max-width: 1100px; margin: 0 auto 40px auto; }
        .team-header { font-size: 1.3rem; font-weight: 800; color: var(--primary); text-transform: uppercase; border-bottom: 4px solid var(--primary); padding-bottom: 8px; margin-bottom: 20px; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: var(--white); padding: 20px; border-radius: 16px; border-left: 10px solid #ddd; box-shadow: 0 4px 6px rgba(0,0,0,0.02); display: flex; flex-direction: column; }
        .day-badge { padding: 6px 14px; border-radius: 8px; font-weight: 700; font-size: 0.8rem; display: inline-block; margin-bottom: 15px; align-self: flex-start; color: white; text-transform: uppercase; }
        .time-row { font-size: 1.2rem; font-weight: 700; color: #334155; margin-bottom: 8px; }
        .field-row { font-size: 0.95rem; color: #64748b; font-weight: 500; }
        .loading { text-align: center; font-size: 1.2rem; font-weight: 600; padding: 100px; color: #94a3b8; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<header>
    <img src="CYTNHIA1920.jpg" alt="Logo Cynthia" class="logo" onerror="this.style.display='none'">
    <h1>Programma Allenamenti Live</h1>
</header>

<div class="filter-section">
    <input type="text" id="teamSearch" class="filter-input" placeholder="Cerca Squadra..." onkeyup="filter()">
    <select id="dayFilter" class="filter-select" onchange="filter()">
        <option value="">Tutti i giorni</option>
        <option value="LUN">Luned√¨</option>
        <option value="MART">Marted√¨</option>
        <option value="MERC">Mercoled√¨</option>
        <option value="GIOV">Gioved√¨</option>
        <option value="VENE">Venerd√¨</option>
    </select>
</div>

<div id="loader" class="loading">üîÑ Caricamento dati Cynthia...</div>
<div id="content"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRcfggcqh-gbdBcErqn9RP0JMx6HVrCXWReKDnixI3JMnVlF_J9cpaws3sHgEfUztCbjHELFws-_O9J/pub?output=csv';
    const allowed = ["PROMOZIONE", "UNDER19", "UNDER17", "UNDER16", "UNDER15", "CARIOTI", "PENDENZA"];

    function init() {
        Papa.parse(csvUrl, {
            download: true,
            header: false,
            complete: function(results) {
                render(results.data);
                document.getElementById('loader').style.display = 'none';
            },
            error: function() {
                document.getElementById('loader').innerHTML = "Errore di connessione. Verifica che il file sia pubblicato su Google Sheets.";
            }
        });
    }

    function render(rows) {
        const content = document.getElementById('content');
        const groups = {};

        rows.forEach((cols, index) => {
            if (index === 0 || !cols[0]) return;
            const name = cols[0].trim().toUpperCase();
            
            if (allowed.some(a => name.includes(a))) {
                if (!groups[name]) groups[name] = [];
                for (let i = 1; i <= 9; i += 4) {
                    if (cols[i+1] && cols[i+1].length > 2) {
                        groups[name].push({
                            campo: cols[i] || '',
                            giorno: cols[i+1] || '',
                            inizio: cols[i+2] || '',
                            fine: cols[i+3] || ''
                        });
                    }
                }
            }
        });

        for (const team in groups) {
            const div = document.createElement('div');
            div.className = 'team-group';
            div.setAttribute('data-name', team);
            
            let cards = '';
            groups[team].forEach(s => {
                const day = s.giorno.toUpperCase();
                let dayColor = 'var(--lun)';
                if (day.includes('MART')) dayColor = 'var(--mar)';
                else if (day.includes('MERC')) dayColor = 'var(--mer)';
                else if (day.includes('GIOV')) dayColor = 'var(--gio)';
                else if (day.includes('VENE')) dayColor = 'var(--ven)';

                const field = s.campo.toUpperCase();
                let borderCol = '#ddd';
                if (field.includes('ABBATINI')) borderCol = 'var(--abbatini)';
                else if (field.includes('INFIORATA')) borderCol = 'var(--infiorata)';
                else if (field.includes('MONTEGIOVE')) borderCol = 'var(--montegiove)';

                cards += `
                    <div class="card" style="border-left-color: ${borderCol}" data-day="${day}">
                        <div class="day-badge" style="background: ${dayColor}">${s.giorno}</div>
                        <div class="time-row">üïí ${s.inizio} - ${s.fine}</div>
                        <div class="field-row">üèüÔ∏è ${s.campo}</div>
                    </div>
                `;
            });

            div.innerHTML = `<div class="team-header">${team}</div><div class="grid-container">${cards}</div>`;
            content.appendChild(div);
        }
    }

    function filter() {
        const q = document.getElementById('teamSearch').value.toUpperCase();
        const d = document.getElementById('dayFilter').value.toUpperCase();
        document.querySelectorAll('.team-group').forEach(group => {
            let hasVisible = false;
            const name = group.getAttribute('data-name');
            group.querySelectorAll('.card').forEach(card => {
                const day = card.getAttribute('data-day');
                const show = name.includes(q) && (d === "" || day.includes(d));
                card.classList.toggle('hidden', !show);
                if (show) hasVisible = true;
            });
            group.classList.toggle('hidden', !hasVisible);
        });
    }

    init();
</script>
</body>
</html>